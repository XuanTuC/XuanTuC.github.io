<!DOCTYPE html>
<html lang="zh-CN">
  <head><!-- hexo injector head_begin start -->
<link rel="stylesheet" href="/css/bilicard.css">
<!-- hexo injector head_begin end -->
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="xuan tu">







<title>FPGA入门初探 | 曲径通幽处.</title>



    <link rel="icon" href="/favicon.ico">



<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Roboto+Mono&display=swap');
</style>



    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    




    <!-- scripts list from _config.yml -->
    
    <script src="/js/frame.js"></script>
    










  <meta name="generator" content="Hexo 6.3.0"></head>
  <body>
    <div class="mask-border">
    </div>

    <div class="wrapper">

      <div class="header">
  <div class="flex-container">
    <div class="header-inner">
      <div class="site-brand-container">
        <a href="/">
          
            ヾ(^_^) back Home.!!
          
        </a>
      </div>
      <div id="menu-btn" class="menu-btn" onclick="toggleMenu()">
        Menu
      </div>
      <nav class="site-nav">
        <ul class="menu-list">
          
            
              <li class="menu-item">
                <a href="/">主页</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/archives/">文章</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a target="_blank" rel="noopener" href="https://drive.google.com/drive/folders/1a-OiD9e0tEgNmWDoR0RGkhBtp-v8TQq8?usp=drive_link">书阁(M)</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a target="_blank" rel="noopener" href="https://github.com/XuanTuC/CTF_BambooSlips">CTF竹简</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a target="_blank" rel="noopener" href="https://linjx1210.github.io/">友链</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a target="_blank" rel="noopener" href="https://xuantuc.github.io/HTML/daohang">网站舆图</a>
              </li> 
                   
          
          
        </ul>
      </nav>
    </div>
  </div>
</div>


      <div class="main">
        <div class="flex-container">
          <article id="post">

  
    <div class="post-head">
    <div class="post-info">
        <div class="tag-list">
            
                
                    <span class="post-tag">
                        <a href="/tags/FPGA/">
                            FPGA
                        </a>
                    </span>    
                           
            
        </div>
        <div class="post-title">
            
            
                FPGA入门初探
            
            
        </div>
        <span class="post-date">
            1月 6, 2025
        </span>
    </div>
    <div class="post-img">
        
            <div class="h-line-primary"></div>
              
    </div>
</div>
    <div class="post-content">
    <blockquote>
<p> 时间：2025年1月7日11:08:49</p>
</blockquote>
<hr>
<h1 id="0-FPGA简介"><a href="#0-FPGA简介" class="headerlink" title="0.FPGA简介"></a>0.FPGA简介</h1><p>芯片的简称叫：IC</p>
<h2 id="芯片分类："><a href="#芯片分类：" class="headerlink" title="芯片分类："></a>芯片分类：</h2><p>1、<strong>ASIC</strong>（专用集成电路）：是一种在设计时就考虑了设计用途的IC。</p>
<p>2、<strong>FPGA</strong>（现场可编程门阵列）：是一种可以进行重新编程设计的IC</p>
<p>FPGA可以通过<strong>重新编程来修改芯片内部逻辑连接和配置</strong>让这个芯片实现你自己想要的功能。</p>
<p>什么是ICT？</p>
<p>计算机半导体通信大类</p>
<ul>
<li>IT</li>
<li>IC</li>
<li>CT</li>
</ul>
<p>wire   |     n.金属线</p>
<p>FPGA的开发：verilog HDL语言</p>
<p>数字信号处理领域：（模拟信号转化为数字信号）软件无线电技术</p>
<h2 id="FPGA生产厂商"><a href="#FPGA生产厂商" class="headerlink" title="FPGA生产厂商"></a><strong>FPGA生产厂商</strong></h2><p>1、<strong>Xilinx（赛灵思）</strong>：是全球领先的可编程逻辑完整解决方案的供应商，也是全球PGA市场份额最大的公司，目前被AMD收购。市场占比最高。提供的主要开发平台：Vivado</p>
<p>2、<strong>Altera（阿尔特拉）</strong>，业界与Xilinx齐名的FPGA供应商，2015年被Intel收购。市场占比排第二。提供的主要开发平台：QuartusII。</p>
<p>3、<strong>Lattice（莱迪思）</strong>，以其低功耗产品著称，Lattice公司是目前唯一一家在中国有研发部的外国FPGA厂商，也为国产FPGA厂商培养了很多业内优秀的管理人员和技术人，当年国内企业欲收购Lattice，而被美国以违反国家安全的名义否决了收购计划，使国产FPGA商业化还要走更长的路。</p>
<p>4、京微齐力、国微电子、711所、复旦微电子、华微电子、紫光同创等</p>
<h1 id="1-创建新项目"><a href="#1-创建新项目" class="headerlink" title="1.创建新项目"></a>1.创建新项目</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">项目存放的绝对路径</span><br><span class="line"></span><br><span class="line">填写与.qbf相同的名字</span><br><span class="line"></span><br><span class="line">与第二行保持一致</span><br></pre></td></tr></table></figure>

<p>器材设备</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">选择自己使用的设备</span><br><span class="line">本例为：EP4CE6F17C8</span><br></pre></td></tr></table></figure>

<p>EP4CE6F17C8</p>
<p><strong>EP</strong>：表示该芯片属于 <strong>Cyclone IV</strong> FPGA 系列。EP 是 <strong>Cyclone FPGA</strong> 的前缀。</p>
<p><strong>4</strong>：表示这是 <strong>Cyclone IV</strong> 系列中的一个器件。Cyclone IV 是英特尔较低功耗、低成本的 FPGA 系列。</p>
<p><strong>CE</strong>：指的是该 FPGA 采用的是 <strong>Cyclone IV E</strong> 系列。Cyclone IV E 是 Cyclone IV 系列中的一个子系列，优化了性能和容量。</p>
<p><strong>6</strong>：表示该 FPGA 的逻辑单元（LE，Logic Element）数量。数字 6 通常代表这个 FPGA 的资源规模是 6K 逻辑单元。</p>
<p><strong>F</strong>：表示该 FPGA 使用的是 <strong>Fine-pitch Ball Grid Array (FBGA)</strong> 封装。F 是指 FBGA 类型封装，用于更小尺寸和更高密度的应用。</p>
<p><strong>17</strong>：代表该芯片的 <strong>I&#x2F;O 引脚数</strong>。数字 17 表示该 FPGA 有 17x17 的引脚阵列（共 289 引脚），具体的引脚配置会影响外部连接能力。</p>
<p><strong>C8</strong>：表示该 FPGA 的 <strong>温度范围和速度等级</strong>。C8 通常代表该 FPGA 在 <strong>商业温度范围（0°C 到 85°C）</strong> 和中等速度等级下工作。</p>
<h1 id="2-not-gate-非门"><a href="#2-not-gate-非门" class="headerlink" title="2.not_gate[非门]"></a>2.not_gate[非门]</h1><p>设计输入输出</p>
<p>创建工程</p>
<p>tools&gt;Netlist views&gt;RTL view</p>
<p>波形图的文件：tb.v</p>
<p><code>not_gate.v</code></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> not_gate(               <span class="comment">//模块 模块名</span></span><br><span class="line">	<span class="keyword">input</span>  <span class="keyword">wire</span>  A  ,          <span class="comment">//括号中逗号作为结尾</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">wire</span>  Y             <span class="comment">//括号中的最后一行不用逗号</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//组合逻辑：输出随输入改变立刻改变，RTL视图综合出来是一根导线</span></span><br><span class="line"><span class="keyword">assign</span> Y = ~A ;                <span class="comment">//assign用于赋值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span>                      <span class="comment">// 结束模块</span></span><br></pre></td></tr></table></figure>



<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250106161416230.png" alt="image-20250106161416230"></p>
<p>顶层</p>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250106173159787.png" alt="image-20250106173159787"></p>
<p>仿真测试：</p>
<p><code>tb_not_gate.v</code></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns/1ps </span><span class="comment">//时间单位，1纳秒、1皮秒，后续若不写默认是纳秒为单位</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">module tb_not_gate();</span></span><br><span class="line"><span class="comment">	wire A ;</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	wire Y ;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> tb_not_gate();</span><br><span class="line">	<span class="keyword">reg</span>	A ;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">wire</span> Y ;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">被赋值的参数遇到ini或者alw要改为寄存器reg型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">initial</span> <span class="keyword">begin</span>	</span><br><span class="line">	A=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> #<span class="number">10</span> A = &#123;<span class="built_in">$random</span>&#125;%<span class="number">2</span> ; <span class="comment">//添加大括号去掉负数	.对2取余，数字范围是0~1，对16取余就是0~15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//打点 例化名 传参</span></span><br><span class="line">not_gate not_gate_inst(               </span><br><span class="line">	. A(A) ,<span class="comment">//括号中的参数来自于当前模块</span></span><br><span class="line">	</span><br><span class="line">	. Y(Y)   <span class="comment">//括号中的最后一行不用逗号</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<p>选择tb文件</p>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250106173339172.png" alt="image-20250106173339172"></p>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250106173959213.png" alt="image-20250106173959213"></p>
<h1 id="3-key-led"><a href="#3-key-led" class="headerlink" title="3.key_led"></a>3.key_led</h1><p>一个按键点亮一个灯</p>
<p>绑定管脚、点亮灯（需要确定是高电平还是低电平点亮）</p>
<p>首先看原理图分析驱动方式<br><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250107092502464.png" alt="image-20250107092502464"></p>
<p>led灯为0亮，1灭</p>
<p>按键的原理图</p>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250107092813118.png" alt="image-20250107092813118"></p>
<p><code>key_led.v</code></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> key_led(</span><br><span class="line">	<span class="keyword">input</span> <span class="keyword">wire</span> key0,</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">wire</span> led0</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//led和key都是低电平有效</span></span><br><span class="line"><span class="keyword">assign</span> led0=key0 ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250107095409219.png" alt="image-20250107095409219"></p>
<p>根据原理图绑定管脚</p>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250107100834630.png" alt="image-20250107100834630"></p>
<p>看原理图，key绑定按键，led绑定灯</p>
<ul>
<li>led原理图</li>
</ul>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250107100453278.png" alt="image-20250107100453278"></p>
<ul>
<li>key原理图</li>
</ul>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250107101457215.png" alt="image-20250107101457215"></p>
<p>绑定完成后再编译一次</p>
<p>随后进行如下设置:</p>
<p>选择.sof文件</p>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250107095835762.png" alt="image-20250107095835762"></p>
<p>等连接设备以后，点击<code>Hardware Setup...</code></p>
<p>点击<code>star</code>进行烧录</p>
<h2 id="仿真测试"><a href="#仿真测试" class="headerlink" title="仿真测试"></a>仿真测试</h2><p><code>tb.v</code></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns/1ps </span><span class="comment">//时间单位，1纳秒、1皮秒，后续若不写默认是纳秒为单位</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> tb();</span><br><span class="line">	<span class="keyword">reg</span> key0;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">wire</span> led0;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">被赋值的参数遇到ini或者alw要改为寄存器reg型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">initial</span> <span class="keyword">begin</span>	</span><br><span class="line"></span><br><span class="line">	key0=<span class="number">0</span>; <span class="comment">//给予低电平</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> #<span class="number">10</span> key0 = &#123;<span class="built_in">$random</span>&#125;%<span class="number">2</span> ; <span class="comment">//添加大括号去掉负数	.对2取余，数字范围是0~1，对16取余就是0~15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//打点 例化名 传参</span></span><br><span class="line">key_led key_led_inst(               </span><br><span class="line">	. key0(key0) ,<span class="comment">//括号中的参数来自于当前模块</span></span><br><span class="line">	        </span><br><span class="line">	. led0(led0)   <span class="comment">//括号中的最后一行不用逗号</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>



<p>仿真结果正确</p>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250107103229325.png" alt="image-20250107103229325"></p>
<h1 id="4-调制解调"><a href="#4-调制解调" class="headerlink" title="4.调制解调"></a>4.调制解调</h1><p>毛刺：干扰信号：竞争冒险</p>
<p>解决竞争冒险</p>
<p>1，时间顺序读取（去掉）</p>
<p>2，填充（找到上一时刻。保持上一时刻的状态，保持的时长为毛刺长度）</p>
<p>3，时间的来源：（ 晶振-&gt; 频率- &gt; 周期-&gt;   &lt;傅里叶变换&gt;   时间）</p>
<p>1<del>0下降沿，0</del>1上升沿</p>
<p>D触发器（晶振的最小时间单元）D_FLIP_FLOP</p>
<ul>
<li>具有记忆性</li>
<li>具有两个稳定状态</li>
<li>信息存储单元</li>
</ul>
<p>边沿触发的标志</p>
<ul>
<li>上升沿触发：向右的三角形，在上升沿之间进行采样，看是高电平还是低电平</li>
<li>下降沿触发：在下降沿之间进行采样，看是高电平还是低电平</li>
</ul>
<p>组合逻辑：即时触发</p>
<p>时序逻辑：时序触发</p>
<h2 id="创建d触发器"><a href="#创建d触发器" class="headerlink" title="创建d触发器"></a>创建d触发器</h2><p>频率50mhz ，周期是20纳秒</p>
<p>时序的实现</p>
<h1 id="状态机"><a href="#状态机" class="headerlink" title="状态机"></a>状态机</h1><h2 id="序列检测："><a href="#序列检测：" class="headerlink" title="序列检测："></a>序列检测：</h2><p>设置一个计数器，如果遇到序列第一个，此计数器加1，再检测下一个，如果仍然满足序列的第二个，则继续加一，若不是序列的第二个则减去一（有的不是，需要具体分析状态机），直到计数器达到序列自身长度</p>
<p>如何寻找10010这一行，例如：接收到10010时才给出一个周期的高电平</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Moore状态机:输出只取决于当前状态，与输入状态无关，有S4</span><br><span class="line"></span><br><span class="line">Mealy状态机:输出不仅取决于当前状态，还和输入有关</span><br></pre></td></tr></table></figure>

<p>重复检测</p>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250108142712411.png" alt="image-20250108142712411"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">如果data==1</span><br><span class="line">	state &lt;=S0</span><br><span class="line">否则</span><br><span class="line">	state &lt;=S</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	if (state == s4)</span><br></pre></td></tr></table></figure>









<p><code>state2.v</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">module state2(</span><br><span class="line">    input wire  clk,</span><br><span class="line">    input wire  rdt_n,</span><br><span class="line">    input wire  state_out,</span><br><span class="line">    input reg   find</span><br><span class="line">  </span><br><span class="line">);</span><br><span class="line">parameter IDLE =6&#x27;000_001 ;       //二进制编码，独热码  </span><br><span class="line">parameter s0 =6&#x27;000_010 ;         //二进制编码，独热码</span><br><span class="line">parameter s1 =6&#x27;000_100 ;         //二进制编码，独热码</span><br><span class="line">parameter s2 =6&#x27;001_000 ;         //二进制编码，独热码</span><br><span class="line">parameter s3 =6&#x27;010_000 ;         //二进制编码，独热码</span><br><span class="line">parameter s4 =6&#x27;100_001 ;         //二进制编码，独热码</span><br><span class="line"></span><br><span class="line">reg [5:0] state; //状态寄存器</span><br><span class="line"></span><br><span class="line">//二段式状态机：第一段描述状态转移，第二段描述状态输出</span><br><span class="line">always @ (posedge clk , negedge rst_n)</span><br><span class="line">	if(~rst_n)</span><br><span class="line">		state &lt;= IDLE ;</span><br><span class="line">	else case (state)</span><br><span class="line">		IDLE : 	if(data==1)</span><br><span class="line">					state &lt;= s0	  ;</span><br><span class="line">				else</span><br><span class="line">					state &lt;= IDLE ;</span><br><span class="line">		s0	 :	if(data==0)</span><br><span class="line">					state &lt;= s1	  ;</span><br><span class="line">				else</span><br><span class="line">					state &lt;= s0   ;</span><br><span class="line">		s1	 :	if(data==0)</span><br><span class="line">					state &lt;= s2	  ;</span><br><span class="line">				else</span><br><span class="line">					state &lt;= s0   ;	</span><br><span class="line">		s2	 :	if(data==1)</span><br><span class="line">					state &lt;= s3	  ;</span><br><span class="line">				else</span><br><span class="line">					state &lt;= IDLE   ;</span><br><span class="line">		s3	 :	if(data==0)</span><br><span class="line">					state &lt;= s4	  ;</span><br><span class="line">				else</span><br><span class="line">					state &lt;= s0   ;</span><br><span class="line">					</span><br><span class="line">		s4	 :	if(data==0)</span><br><span class="line">					state &lt;= s2	  ;    //重复检测100</span><br><span class="line">				else</span><br><span class="line">					state &lt;= s0   ;</span><br><span class="line">					</span><br><span class="line">		default	 :	state &lt;= state;</span><br><span class="line">	endcase</span><br><span class="line"></span><br><span class="line">always @ (posedge clk , negedge rst_n)//状态输出</span><br><span class="line">	if(~rst_n)</span><br><span class="line">		find &lt;= 0 ;</span><br><span class="line">    else if (state == s4)</span><br><span class="line">		find &lt;= 1 ;</span><br><span class="line">	else</span><br><span class="line">		find &lt;= 0 ;</span><br><span class="line"></span><br><span class="line">endmodule</span><br></pre></td></tr></table></figure>





<h1 id="UART总线"><a href="#UART总线" class="headerlink" title="UART总线"></a>UART总线</h1><p>三大低速总线（UART、 SPI、 IIC）</p>
<p>RXD：接收数据</p>
<p>TXD：发送数据</p>
<p>串口的协议之一：RS232</p>
<p>串口的帧结构（一个最基本的 RS232 帧结构）</p>
<p>8位宽数据，每一位都是1bit</p>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/wps1.jpg" alt="img"></p>
<p>1bit持续的时间为<strong>波特率</strong>（baud），常用4800、9600</p>
<p>比特率：1秒钟发送了多少个bit</p>
<p>比特率&#x3D;波特率 * 单个调制状态对应的二进制位数，如果使用的是 9600 的波特率，其串口的比特率为： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9600Bps *1bit= 9600bps。</span><br></pre></td></tr></table></figure>

<p><code>bps = bit/s</code></p>
<p>由计算得串口发送或者接收 1bit 数据的时间为一个波特，即 1&#x2F;9600 秒，如果用<br>50MHz（周期为 20ns）的系统时钟来计数，需要计数的个数为 cnt &#x3D; (1s * 10^9)ns &#x2F;<br>9600bit)ns &#x2F; 20ns ≈ 5208 个系统时钟周期，即每个 bit 数据之间的间隔要在 50MHz 的时钟频率下计数 5208 次(13位宽)。<br>$$<br>2^{13}<br>$$</p>
<h2 id="位拼接"><a href="#位拼接" class="headerlink" title="位拼接"></a>位拼接</h2><p>组合逻辑中的毛刺叫：<strong>竞争冒险</strong></p>
<p>时序逻辑中的毛刺叫：<strong>亚稳态</strong></p>
<p>bit_cnt &#x3D;&#x3D;8 &amp;&amp; bit_flag&#x3D;&#x3D;1的时候，work_en 拉低</p>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250109155739685.png" alt="image-20250109155739685"></p>
<p><code>uart_rx.v</code></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> uart_rx </span><br><span class="line">#(</span><br><span class="line">    <span class="keyword">parameter</span>  CNT_MAX  = <span class="number">50_000_000</span>/<span class="number">9600</span> </span><br><span class="line">)</span><br><span class="line">(</span><br><span class="line"><span class="keyword">input</span>   <span class="keyword">wire</span>        sys_clk      ,</span><br><span class="line"><span class="keyword">input</span>   <span class="keyword">wire</span>        sys_rst_n    ,</span><br><span class="line"><span class="keyword">input</span>   <span class="keyword">wire</span>        rx           ,</span><br><span class="line"></span><br><span class="line"><span class="keyword">output</span>  <span class="keyword">reg</span>  [<span class="number">7</span>:<span class="number">0</span>]  po_data      ,</span><br><span class="line"><span class="keyword">output</span>  <span class="keyword">reg</span>         po_flag      </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span>              rx_reg1           ;</span><br><span class="line"><span class="keyword">reg</span>              rx_reg2           ;</span><br><span class="line"><span class="keyword">reg</span>              rx_reg3           ;</span><br><span class="line"><span class="keyword">reg</span>              start_nedge       ;</span><br><span class="line"><span class="keyword">reg</span>              bit_flag          ;  <span class="comment">//5208/2-1最稳定，取走</span></span><br><span class="line"><span class="keyword">reg</span>    [<span class="number">3</span>:<span class="number">0</span>]     bit_cnt           ;  <span class="comment">//记录8个bit数据</span></span><br><span class="line"><span class="keyword">reg</span>              work_en           ;</span><br><span class="line"><span class="keyword">reg</span>    [<span class="number">12</span>:<span class="number">0</span>]    baud_cnt          ;</span><br><span class="line"><span class="keyword">reg</span>    [<span class="number">7</span>:<span class="number">0</span>]     rx_data           ;  <span class="comment">//拼接</span></span><br><span class="line"><span class="keyword">reg</span>              rx_flag           ;  <span class="comment">//出稳定数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)  <span class="comment">//~sys_rst_n  sys_rst_n==0</span></span><br><span class="line">		<span class="keyword">begin</span></span><br><span class="line">        rx_reg1 &lt;= <span class="number">1&#x27;b1</span>; <span class="comment">// 并行赋值</span></span><br><span class="line">        rx_reg2 &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">        rx_reg3 &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">		<span class="keyword">begin</span></span><br><span class="line">        rx_reg1 &lt;= rx; <span class="comment">//原本的信号给下一个寄存器</span></span><br><span class="line">        rx_reg2 &lt;= rx_reg1;</span><br><span class="line">        rx_reg3 &lt;= rx_reg2;</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        start_nedge &lt;= <span class="number">1&#x27;b0</span>;  <span class="comment">//下降沿开始信号</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((~rx_reg2) &amp;&amp; (rx_reg3))</span><br><span class="line">        start_nedge &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        start_nedge &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        bit_flag &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(baud_cnt == CNT_MAX/<span class="number">2</span> - <span class="number">1</span>) <span class="comment">//CNT_MAX &gt;&gt; 1</span></span><br><span class="line">        bit_flag &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        bit_flag &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        bit_cnt &lt;= <span class="number">4&#x27;b0</span>; <span class="comment">//bit计数器清零</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(bit_cnt == <span class="number">4&#x27;d8</span> &amp;&amp; bit_flag == <span class="number">1&#x27;b1</span>)  <span class="comment">//bit计数器计数到8，并且bit_flag为1时,bit计数器清零</span></span><br><span class="line">        bit_cnt &lt;= <span class="number">4&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(bit_flag)</span><br><span class="line">        bit_cnt &lt;= bit_cnt + <span class="number">1&#x27;b1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)  <span class="comment">//sys_rst_n==0 时</span></span><br><span class="line">        work_en &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(start_nedge)</span><br><span class="line">        work_en &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(bit_cnt == <span class="number">4&#x27;d8</span> &amp;&amp; bit_flag == <span class="number">1&#x27;b1</span>) <span class="comment">//bit计数器为8，且bit_flag为1时</span></span><br><span class="line">        work_en &lt;= <span class="number">1&#x27;b0</span>; <span class="comment">//工作使能为0</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        baud_cnt &lt;= <span class="number">13&#x27;b0</span>; <span class="comment">//波特计数器清零</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>((baud_cnt == CNT_MAX - <span class="number">1</span>)  ||  work_en == <span class="number">1&#x27;b0</span>) <span class="comment">//work_en为0时，波特计数器清零,或者波特计数器达到最大值时,波特计数器清零</span></span><br><span class="line">        baud_cnt &lt;= <span class="number">13&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(work_en == <span class="number">1&#x27;b1</span>)</span><br><span class="line">        baud_cnt &lt;= baud_cnt + <span class="number">1&#x27;b1</span>;<span class="comment">//波特计数器加1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        rx_data &lt;= <span class="number">8&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(bit_cnt &gt;= <span class="number">4&#x27;b1</span> &amp;&amp; bit_cnt &lt;= <span class="number">4&#x27;d8</span> &amp;&amp; bit_flag == <span class="number">1&#x27;b1</span>)</span><br><span class="line">        rx_data &lt;= &#123;rx_reg3,rx_data[<span class="number">7</span>:<span class="number">1</span>]&#125;;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        rx_flag &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(bit_cnt == <span class="number">4&#x27;d8</span> &amp;&amp; bit_flag)</span><br><span class="line">        rx_flag &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        rx_flag &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        po_data &lt;= <span class="number">8&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(rx_flag == <span class="number">1&#x27;b1</span>)</span><br><span class="line">        po_data &lt;= rx_data;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> sys_clk <span class="keyword">or</span> <span class="keyword">negedge</span> sys_rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!sys_rst_n)</span><br><span class="line">        po_flag &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        po_flag &lt;= rx_flag;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<p>得出的电路图如下：</p>
<p><img src="https://tuchuan-1317533020.cos.ap-nanjing.myqcloud.com/image/image-20250109161004346.png" alt="image-20250109161004346"></p>
<h1 id="end"><a href="#end" class="headerlink" title="end"></a>end</h1><p>位宽以该数的二进制位数为准</p>
<p>串口的数据接收和发送</p>
<p>tx：主机发送</p>
<p>rx：经过判断语句，若符合条件则返回一个信息</p>
<p>串口调试助手中显示的tx,rx都是在主机这一侧的，</p>
<p>”32位宽的16进制数44556677“ 的写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">32&#x27;h44556677</span><br></pre></td></tr></table></figure>



<p>不描述状态转移，使用拼接方式</p>
<p>模块名：led</p>
<p>状态机的第十三种写法：拼接</p>
<p>default</p>
<p>case既有选择也有begin的用法</p>
<p>状态机类型：摩尔型（有s4）、米粒型 </p>
<p>三位宽格雷码的全部表示内容</p>
<p>串行并行转换</p>

</div> 

<script>
    window.onload = detectors();
</script>
    <div class="post-footer">
    <div class="h-line-primary"></div>
    <nav class="post-nav">
        <div class="prev-item">
           
                <div class="icon arrow-left"></div>
                <div class="post-link">
                    <a href="/2025/01/07/howtomovejs/">Prev</a>
                </div>
            
        </div>
        <div class="next-item">
            
                <div class="icon arrow-right"></div>
                <div class="post-link">
                  <a href="/2024/12/22/yafu/">Next</a>  
                </div>  
            
        </div>
    </nav>
</div>

    
      <div class="post-comment">

     

     


    
       <!--PC版-->
        <div id="SOHUCS" ></div>
        <script charset="utf-8" type="text/javascript" src="https://cy-cdn.kuaizhan.com/upload/changyan.js" ></script>
        <script type="text/javascript">
        window.changyan.api.config({
            appid: 'cywJvGKKO',
            conf: 'prod_dfd0ec91693832034dcc62943592b045'
        });
        </script>   
     

</div>
     
  
</article>
        </div>
      </div>
      
      <div class="footer">
    <div class="flex-container">
        <div class="footer-text">
            
                人生得意须尽欢，莫使金樽空对月.
                <br>
            
            
                xuan_tu | 
            
                
        </div>
    </div>
</div>

    </div>

    
    

  </body>
</html>
