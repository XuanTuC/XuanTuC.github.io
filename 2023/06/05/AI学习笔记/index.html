<!DOCTYPE html>
<html lang="zh-CN">
  <head><!-- hexo injector head_begin start -->
<link rel="stylesheet" href="/css/bilicard.css">
<!-- hexo injector head_begin end -->
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="xuan tu">







<title>AI学习笔记 | 曲径通幽处.</title>



    <link rel="icon" href="/favicon.ico">



<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Roboto+Mono&display=swap');
</style>



    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    




    <!-- scripts list from _config.yml -->
    
    <script src="/js/frame.js"></script>
    










  <meta name="generator" content="Hexo 6.3.0"></head>
  <body>
    <div class="mask-border">
    </div>

    <div class="wrapper">

      <div class="header">
  <div class="flex-container">
    <div class="header-inner">
      <div class="site-brand-container">
        <a href="/">
          
            ヾ(^_^) back Home.!!
          
        </a>
      </div>
      <div id="menu-btn" class="menu-btn" onclick="toggleMenu()">
        Menu
      </div>
      <nav class="site-nav">
        <ul class="menu-list">
          
            
              <li class="menu-item">
                <a href="/">主页</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a href="/archives/">文章</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a target="_blank" rel="noopener" href="https://drive.google.com/drive/folders/1a-OiD9e0tEgNmWDoR0RGkhBtp-v8TQq8?usp=drive_link">书阁(M)</a>
              </li> 
                   
          
            
              <li class="menu-item">
                <a target="_blank" rel="noopener" href="https://github.com/XuanTuC/CTF_BambooSlips">CTF竹简</a>
              </li> 
                   
          
          
        </ul>
      </nav>
    </div>
  </div>
</div>


      <div class="main">
        <div class="flex-container">
          <article id="post">

  
    <div class="post-head">
    <div class="post-info">
        <div class="tag-list">
            
        </div>
        <div class="post-title">
            
            
                AI学习笔记
            
            
        </div>
        <span class="post-date">
            6月 5, 2023
        </span>
    </div>
    <div class="post-img">
        
            <div class="h-line-primary"></div>
              
    </div>
</div>
    <div class="post-content">
    <p>JSON（JavaScript Object Notation）是一种轻量级的数据交换格式，它使用易于人类阅读和编写的文本格式，并且可以被多种编程语言解析和生成。JSON文件用于存储和传输数据，通常在Web应用程序中用于从服务器获取数据并将其显示在用户界面上。</p>
<p>JSON文件由键-值对组成，类似于JavaScript对象，其中每个键都是一个字符串，值可以是字符串、数字、布尔值、数组或其他JSON对象。JSON文件可以包含任意数量的键-值对，使其非常适合表示结构化数据，如配置文件、日志文件、API响应和数据库记录等。</p>
<p>也可以包含网址等信息</p>
<p><strong>tesk2</strong></p>
<p>Task02:数据集的读取与可视化<br>一、任务目的：了解图像数据集的存储方式，学会读取数据并对数据进行存储格式的转换，实现数据可视化。</p>
<p>二、主要任务（以coco数据集的标签文件为例）：</p>
<p>1、标签数据读取：读取数据集标签文件“TestData_coco.json”；</p>
<p>2、图像数据下载：根据标签数据中图像链接下载相应图像并以图像ID命名；</p>
<p>3、数据存储格式变换：为一幅图像建立一个字典，字典中包含{‘image_ids’, ‘category_ids’, ‘bboxes’, ‘segmentations’}等键，每个键构建一个list，存储该幅图像中包含的目标类别、目标框和分割标签信息。<br>4、可视化图像ID为1000的图像及标签：显示图像、目标框和分割信息，并在目标框左上角标注类别名称，如图例所示；</p>
<p><img src="https://github.com/AceForest/Assignment/blob/main/Example%20image/segmentation_139.png" alt="img"></p>
<p>5、抽取部分数据保存成新的json文件：从数据集中挑选出图像ID为‘139’，‘724’，‘785’，‘885’和‘1000’的图像及相应标注框和分割掩码标签，保存成新的标签文件，格式与原文件保持一致。</p>
<p>三、任务要求：语言不限，推荐使用Python语言。</p>
<p>将一个图片转换成字典的python脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取图像文件</span></span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&#x27;000000000885.jpg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取图像的尺寸</span></span><br><span class="line">width, height = img.size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个空字典</span></span><br><span class="line">pixels_dict = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历每个像素点</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">        <span class="comment"># 获取当前像素点的颜色值</span></span><br><span class="line">        pixel = img.getpixel((x, y))</span><br><span class="line">        <span class="comment"># 将像素点和颜色值添加到字典中</span></span><br><span class="line">        pixels_dict[(x, y)] = pixel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储字典到本地文件系统</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;pixels_dict.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="built_in">str</span>(pixels_dict))</span><br></pre></td></tr></table></figure>

<h2 id="从图像中提取目标框和分割标签信息，我要用到什么工具"><a href="#从图像中提取目标框和分割标签信息，我要用到什么工具" class="headerlink" title="从图像中提取目标框和分割标签信息，我要用到什么工具?"></a>从图像中提取目标框和分割标签信息，我要用到什么工具?</h2><p>要从图像中提取目标框和分割标签信息，您可以使用以下工具：</p>
<ol>
<li>图像处理库：例如OpenCV、Pillow等</li>
<li>目标检测模型：例如Faster R-CNN、YOLO、SSD等</li>
<li>图像语义分割模型：例如Mask R-CNN、FCN等</li>
</ol>
<p>这些工具可以帮助识别和定位图像中的对象，并生成相应的目标框和分割标签信息。其中，目标检测模型可以检测出图像中的物体并给出其边界框，而图像语义分割模型可以将图像中的不同区域进行划分，并为每个区域打上特定的标签。使用这些工具可以高效地完成目标检测和分割任务。</p>
<h2 id="如何用Pillow库提取目标框？"><a href="#如何用Pillow库提取目标框？" class="headerlink" title="如何用Pillow库提取目标框？"></a>如何用Pillow库提取目标框？</h2><p>要使用Pillow库提取目标框，可以按照以下步骤进行：</p>
<ol>
<li>打开图片文件并加载到Pillow的Image对象中：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">image = Image.<span class="built_in">open</span>(<span class="string">&quot;image.jpg&quot;</span>)</span><br></pre></td></tr></table></figure>

<ol>
<li>定义一个包含目标位置信息的元组（left, upper, right, lower），其中left和upper是目标框左上角的x和y坐标，right和lower是右下角的x和y坐标。</li>
<li>调用Pillow的crop()方法，使用该元组作为参数来提取目标框：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义目标位置信息元组</span></span><br><span class="line">box = (<span class="number">100</span>, <span class="number">100</span>, <span class="number">300</span>, <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取目标框</span></span><br><span class="line">target = image.crop(box)</span><br></pre></td></tr></table></figure>

<p>##PIL:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Pillow</span><br></pre></td></tr></table></figure>



<h2 id="我如何得到right和lower、left和upper？"><a href="#我如何得到right和lower、left和upper？" class="headerlink" title="我如何得到right和lower、left和upper？"></a>我如何得到right和lower、left和upper？</h2><p>可以使用Python中的<code>cv2.boundingRect(contour)</code>函数来获取轮廓的边界框。该函数将返回四个值：x，y，w和h。其中，(x, y)是矩形左上角点的坐标，w和h分别是矩形的宽度和高度。因此，可以通过以下代码来获取right、lower、left和upper：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Copy Codex, y, w, h = cv2.boundingRect(contour)</span><br><span class="line">right = x + w</span><br><span class="line">lower = y + h</span><br><span class="line">left = x</span><br><span class="line">upper = y</span><br></pre></td></tr></table></figure>

<p>这里假设<code>contour</code>是一个<strong>OpenCV</strong>中的轮廓对象。</p>
<h2 id="我如何给一张图片添加OpenCV中的轮廓对象"><a href="#我如何给一张图片添加OpenCV中的轮廓对象" class="headerlink" title="我如何给一张图片添加OpenCV中的轮廓对象"></a>我如何给一张图片添加OpenCV中的轮廓对象</h2><p>要在OpenCV中给一张图片添加轮廓对象，需要按照以下步骤进行操作：</p>
<ol>
<li><p>读取图像并将其转换为灰度图像：使用<code>cv2.imread()</code>函数加载图像，并使用<code>cv2.cvtColor()</code>函数将图像转换为灰度图像。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the image</span></span><br><span class="line">img = cv2.imread(<span class="string">&#x27;image.jpg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert to grayscale</span></span><br><span class="line">gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span><br></pre></td></tr></table></figure>
</li>
<li><p>对图像进行边缘检测：使用任意的边缘检测算法（如Canny算子）对灰度图像进行边缘检测。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Apply Canny edge detection</span></span><br><span class="line">edges = cv2.Canny(gray, <span class="number">100</span>, <span class="number">200</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>查找轮廓并绘制：使用<code>cv2.findContours()</code>函数查找图像中的所有轮廓，并使用<code>cv2.drawContours()</code>函数将轮廓绘制到原始图像上。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Find contours</span></span><br><span class="line">contours, hierarchy = cv2.findContours(edges, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Draw contours on the original image</span></span><br><span class="line">cv2.drawContours(img, contours, -<span class="number">1</span>, (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">2</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>完整代码示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the image</span></span><br><span class="line">img = cv2.imread(<span class="string">&#x27;image.jpg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert to grayscale</span></span><br><span class="line">gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply Canny edge detection</span></span><br><span class="line">edges = cv2.Canny(gray, <span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find contours</span></span><br><span class="line">contours, hierarchy = cv2.findContours(edges, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Draw contours on the original image</span></span><br><span class="line">cv2.drawContours(img, contours, -<span class="number">1</span>, (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the result</span></span><br><span class="line">cv2.imshow(<span class="string">&#x27;Contours&#x27;</span>, img)</span><br><span class="line">cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>

<p>这段代码将在窗口中显示带有轮廓的原始图像。</p>
<p>##cv2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install opencv-python</span><br></pre></td></tr></table></figure>

<p>初次尝试未成功的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the image</span></span><br><span class="line">img = cv2.imread(<span class="string">&#x27;000000000885.jpg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert to grayscale</span></span><br><span class="line">gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply Canny edge detection</span></span><br><span class="line">edges = cv2.Canny(gray, <span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find contours</span></span><br><span class="line">contours, hierarchy = cv2.findContours(edges, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Draw contours on the original image</span></span><br><span class="line">cv2.drawContours(img, contours, -<span class="number">1</span>, (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get bounding boxes of contours</span></span><br><span class="line">bboxes = []</span><br><span class="line"><span class="keyword">for</span> contour <span class="keyword">in</span> contours:</span><br><span class="line">    x, y, w, h = cv2.boundingRect(contour)</span><br><span class="line">    right = x + w</span><br><span class="line">    lower = y + h</span><br><span class="line">    left = x</span><br><span class="line">    upper = y</span><br><span class="line">    bboxes.append([left, upper, right, lower])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Open the image for further processing</span></span><br><span class="line">image = Image.<span class="built_in">open</span>(<span class="string">&quot;000000000885.jpg&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the target box coordinates as a tuple</span></span><br><span class="line">box_coords = (<span class="number">100</span>, <span class="number">100</span>, <span class="number">300</span>, <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Extract the target box as a new image</span></span><br><span class="line">target_image = image.crop(box_coords)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Assume you have obtained the target class, bounding box, and segmentation label information and stored them in respective variables</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create an empty list to store the entry for each object</span></span><br><span class="line">annotations_list = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># For each object, create a dictionary entry and add it to the list</span></span><br><span class="line">num_objects = <span class="number">3</span></span><br><span class="line">image_id = <span class="number">885</span></span><br><span class="line">category_ids = [<span class="string">&quot;human&quot;</span>, <span class="string">&quot;dog&quot;</span>, <span class="string">&quot;cat&quot;</span>]  <span class="comment"># use list instead of string</span></span><br><span class="line">segmentations = [<span class="string">&quot;person&quot;</span>, <span class="string">&quot;dog&quot;</span>, <span class="string">&quot;cat&quot;</span>]  <span class="comment"># use list instead of string</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_objects):</span><br><span class="line">    annotation_dict = &#123;</span><br><span class="line">        <span class="string">&#x27;image_id&#x27;</span>: image_id,</span><br><span class="line">        <span class="string">&#x27;category_id&#x27;</span>: category_ids[i],</span><br><span class="line">        <span class="string">&#x27;bbox&#x27;</span>: bboxes[i],</span><br><span class="line">        <span class="string">&#x27;segmentation&#x27;</span>: segmentations[i]</span><br><span class="line">    &#125;</span><br><span class="line">    annotations_list.append(annotation_dict)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the final dictionary containing keys such as &#x27;image_ids&#x27;, &#x27;category_ids&#x27;, &#x27;bboxes&#x27;, and &#x27;segmentations&#x27;, and store it as a list</span></span><br><span class="line">annotations_dict = &#123;</span><br><span class="line">    <span class="string">&#x27;image_ids&#x27;</span>: [image_id],</span><br><span class="line">    <span class="string">&#x27;category_ids&#x27;</span>: [ann[<span class="string">&#x27;category_id&#x27;</span>] <span class="keyword">for</span> ann <span class="keyword">in</span> annotations_list],</span><br><span class="line">    <span class="string">&#x27;bboxes&#x27;</span>: [ann[<span class="string">&#x27;bbox&#x27;</span>] <span class="keyword">for</span> ann <span class="keyword">in</span> annotations_list],</span><br><span class="line">    <span class="string">&#x27;segmentations&#x27;</span>: [ann[<span class="string">&#x27;segmentation&#x27;</span>] <span class="keyword">for</span> ann <span class="keyword">in</span> annotations_list]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Open the file for writing</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;annotations.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># Write the dictionary to the file</span></span><br><span class="line">    f.write(<span class="built_in">str</span>(annotations_dict))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Close the file</span></span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define functions to get image and category information</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_image_info</span>(<span class="params"><span class="string">&#x27;image_id&#x27;</span></span>):</span><br><span class="line">    <span class="comment"># Implementation of getting image info</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_categories</span>():</span><br><span class="line">    <span class="comment"># Implementation of getting categories</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the image using PIL</span></span><br><span class="line">image_path = <span class="string">&#x27;000000000885.jpg&#x27;</span></span><br><span class="line">image = Image.<span class="built_in">open</span>(image_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the image id, bounding boxes, and segmentation masks</span></span><br><span class="line">image_id = <span class="number">885</span></span><br><span class="line">image_info = get_image_info(image_id)</span><br><span class="line">categories = get_categories()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib.patches <span class="keyword">import</span> Rectangle</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a plot with the image and bounding boxes</span></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">ax.imshow(image)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(image_info[<span class="string">&#x27;bboxes&#x27;</span>])):</span><br><span class="line">    bbox = image_info[<span class="string">&#x27;bboxes&#x27;</span>][i]</span><br><span class="line">    category_id = image_info[<span class="string">&#x27;category_ids&#x27;</span>][i]</span><br><span class="line">    category_name = categories[category_id][<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    seg_mask = image_info[<span class="string">&#x27;segmentations&#x27;</span>][i]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add a rectangle for the bounding box</span></span><br><span class="line">    rect = Rectangle((bbox[<span class="number">0</span>], bbox[<span class="number">1</span>]), bbox[<span class="number">2</span>] - bbox[<span class="number">0</span>], bbox[<span class="number">3</span>] - bbox[<span class="number">1</span>], linewidth=<span class="number">1</span>, edgecolor=<span class="string">&#x27;r&#x27;</span>,</span><br><span class="line">                     facecolor=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">    ax.add_patch(rect)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add the category name as text next to the bounding box</span></span><br><span class="line">    ax.text(bbox[<span class="number">0</span>], bbox[<span class="number">1</span>], category_name, fontsize=<span class="number">8</span>, color=<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第二次尝试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取标签数据</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;TestData_coco.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = json.load(f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载图像并以图像ID命名</span></span><br><span class="line"><span class="keyword">for</span> img <span class="keyword">in</span> data[<span class="string">&#x27;images&#x27;</span>]:</span><br><span class="line">    url = img[<span class="string">&#x27;coco_url&#x27;</span>]</span><br><span class="line">    img_id = <span class="built_in">str</span>(img[<span class="string">&#x27;id&#x27;</span>]).zfill(<span class="number">12</span>)</span><br><span class="line">    filename = img_id + <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">    urllib.request.urlretrieve(url, filename)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立字典存储数据</span></span><br><span class="line">img_dict = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> img <span class="keyword">in</span> data[<span class="string">&#x27;images&#x27;</span>]:</span><br><span class="line">    img_id = img[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">    img_dict[img_id] = &#123;<span class="string">&#x27;image_ids&#x27;</span>: [], <span class="string">&#x27;category_ids&#x27;</span>: [], <span class="string">&#x27;bboxes&#x27;</span>: [], <span class="string">&#x27;segmentations&#x27;</span>: []&#125;</span><br><span class="line"><span class="keyword">for</span> ann <span class="keyword">in</span> data[<span class="string">&#x27;annotations&#x27;</span>]:</span><br><span class="line">    img_id = ann[<span class="string">&#x27;image_id&#x27;</span>]</span><br><span class="line">    img_dict[img_id][<span class="string">&#x27;image_ids&#x27;</span>].append(img_id)</span><br><span class="line">    img_dict[img_id][<span class="string">&#x27;category_ids&#x27;</span>].append(ann[<span class="string">&#x27;category_id&#x27;</span>])</span><br><span class="line">    img_dict[img_id][<span class="string">&#x27;bboxes&#x27;</span>].append(ann[<span class="string">&#x27;bbox&#x27;</span>])</span><br><span class="line">    img_dict[img_id][<span class="string">&#x27;segmentations&#x27;</span>].append(ann[<span class="string">&#x27;segmentation&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化图像ID为1000的图像及标签</span></span><br><span class="line">img_path = <span class="string">&#x27;000000001000.jpg&#x27;</span></span><br><span class="line">img = Image.<span class="built_in">open</span>(img_path)</span><br><span class="line">draw = ImageDraw.Draw(img)</span><br><span class="line"><span class="keyword">for</span> ann <span class="keyword">in</span> data[<span class="string">&#x27;annotations&#x27;</span>]:</span><br><span class="line">    <span class="keyword">if</span> ann[<span class="string">&#x27;image_id&#x27;</span>] == <span class="number">1000</span>:</span><br><span class="line">        bbox = ann[<span class="string">&#x27;bbox&#x27;</span>]</span><br><span class="line">        draw.rectangle([(bbox[<span class="number">0</span>], bbox[<span class="number">1</span>]), (bbox[<span class="number">0</span>]+bbox[<span class="number">2</span>], bbox[<span class="number">1</span>]+bbox[<span class="number">3</span>])], outline=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">        cat_id = ann[<span class="string">&#x27;category_id&#x27;</span>]</span><br><span class="line">        cat_name = data[<span class="string">&#x27;categories&#x27;</span>][cat_id][<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        draw.text((bbox[<span class="number">0</span>], bbox[<span class="number">1</span>]-<span class="number">15</span>), cat_name, fill=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">img.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽取部分数据保存成新的json文件</span></span><br><span class="line">new_data = &#123;<span class="string">&#x27;licenses&#x27;</span>: data[<span class="string">&#x27;licenses&#x27;</span>], <span class="string">&#x27;info&#x27;</span>: data[<span class="string">&#x27;info&#x27;</span>], <span class="string">&#x27;categories&#x27;</span>: data[<span class="string">&#x27;categories&#x27;</span>], <span class="string">&#x27;images&#x27;</span>: [], <span class="string">&#x27;annotations&#x27;</span>: []&#125;</span><br><span class="line"><span class="keyword">for</span> img_id <span class="keyword">in</span> [<span class="number">139</span>, <span class="number">724</span>, <span class="number">785</span>, <span class="number">885</span>, <span class="number">1000</span>]:</span><br><span class="line">    new_data[<span class="string">&#x27;images&#x27;</span>].append(data[<span class="string">&#x27;images&#x27;</span>][<span class="built_in">id</span>])</span><br><span class="line">    anns = [ann <span class="keyword">for</span> ann <span class="keyword">in</span> data[<span class="string">&#x27;annotations&#x27;</span>] <span class="keyword">if</span> ann[<span class="string">&#x27;image_id&#x27;</span>] == <span class="built_in">id</span>]</span><br><span class="line">    new_data[<span class="string">&#x27;annotations&#x27;</span>].extend(anns)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;NewTestData_coco.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(new_data, f)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后一部分存在问题，且该程序虽然能够实现框出物体，但是错误的把人标识成了自行车（T_T）</p>
<h3 id="看了别人的，用到了pycocotools这个库，于是查了一下他是干什么的："><a href="#看了别人的，用到了pycocotools这个库，于是查了一下他是干什么的：" class="headerlink" title="看了别人的，用到了pycocotools这个库，于是查了一下他是干什么的："></a>看了别人的，用到了pycocotools这个库，于是查了一下他是干什么的：</h3><p><code>pycocotools</code> 是一个 Python 库，用于处理 COCO 数据集（Common Objects in Context）。COCO 数据集是一个非常受欢迎的计算机视觉数据集，其中包含了各种常见物体的图像，如人、动物、车辆等，并且为每个对象提供了遮挡、不同角度和光照条件下的多个标注框。该数据集旨在支持目标检测、分割、姿态估计等多个任务。</p>
<p><code>pycocotools</code> 提供了一系列工具函数，用于解析 COCO 数据集中的注释信息、评估模型预测结果和可视化注释等，使得使用 COCO 数据集进行目标检测与分割相关研究的开发者能够更加方便地进行实验和评估。</p>
<p>一个可行的程序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib.patches <span class="keyword">import</span> Rectangle</span><br><span class="line"><span class="keyword">from</span> pycocotools.coco <span class="keyword">import</span> COCO</span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务1: 加载COCO数据集的标签文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_coco_data</span>(<span class="params">json_path</span>):</span><br><span class="line">    coco = COCO(json_path)</span><br><span class="line">    <span class="keyword">return</span> coco</span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务2: 下载图像并以其ID命名保存到指定目录中</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_images</span>(<span class="params">coco, output_dir</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(output_dir):</span><br><span class="line">        os.makedirs(output_dir)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> img_id <span class="keyword">in</span> coco.imgs:</span><br><span class="line">        img_info = coco.loadImgs(ids=img_id)[<span class="number">0</span>]</span><br><span class="line">        url = img_info[<span class="string">&#x27;coco_url&#x27;</span>]</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(output_dir, <span class="string">f&#x27;<span class="subst">&#123;img_id&#125;</span>.jpg&#x27;</span>), <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(response.content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务3: 转换数据格式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform_data</span>(<span class="params">coco</span>):</span><br><span class="line">    transformed_data = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> img_id <span class="keyword">in</span> coco.imgs:</span><br><span class="line">        ann_ids = coco.getAnnIds(imgIds=img_id)</span><br><span class="line">        annotations = coco.loadAnns(ids=ann_ids)</span><br><span class="line">        transformed_data[img_id] = &#123;<span class="string">&#x27;image_ids&#x27;</span>: [img_id],</span><br><span class="line">                                    <span class="string">&#x27;category_ids&#x27;</span>: [ann[<span class="string">&#x27;category_id&#x27;</span>] <span class="keyword">for</span> ann <span class="keyword">in</span> annotations],</span><br><span class="line">                                    <span class="string">&#x27;bboxes&#x27;</span>: [ann[<span class="string">&#x27;bbox&#x27;</span>] <span class="keyword">for</span> ann <span class="keyword">in</span> annotations],</span><br><span class="line">                                    <span class="string">&#x27;segmentations&#x27;</span>: [ann[<span class="string">&#x27;segmentation&#x27;</span>] <span class="keyword">for</span> ann <span class="keyword">in</span> annotations]&#125;</span><br><span class="line">    <span class="keyword">return</span> transformed_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务4: 可视化图像ID为1000的图像及其标签</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">visualize_image</span>(<span class="params">image_id, data, image_dir, coco</span>):</span><br><span class="line">    img_info = coco.loadImgs(ids=image_id)[<span class="number">0</span>]</span><br><span class="line">    image = Image.<span class="built_in">open</span>(os.path.join(image_dir, <span class="string">f&quot;<span class="subst">&#123;image_id&#125;</span>.jpg&quot;</span>))</span><br><span class="line"></span><br><span class="line">    plt.figure()</span><br><span class="line">    plt.imshow(image)</span><br><span class="line">    ax = plt.gca()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义一个颜色列表，用于给不同的标签分配不同的颜色</span></span><br><span class="line">    colors = [<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;m&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, (category_id, bbox) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(data[image_id][<span class="string">&#x27;category_ids&#x27;</span>], data[image_id][<span class="string">&#x27;bboxes&#x27;</span>])):</span><br><span class="line">        category_name = coco.loadCats(ids=category_id)[<span class="number">0</span>][<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        x, y, width, height = bbox</span><br><span class="line">        rect = Rectangle((x, y), width, height, linewidth=<span class="number">2</span>, edgecolor=colors[i % <span class="built_in">len</span>(colors)], facecolor=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">        ax.add_patch(rect)</span><br><span class="line">        <span class="comment"># 设置字体大小为8，颜色为黑色，透明度为0.35</span></span><br><span class="line">        plt.text(x, y, category_name, color=<span class="string">&#x27;k&#x27;</span>, fontsize=<span class="number">8</span>, backgroundcolor=colors[i % <span class="built_in">len</span>(colors)], alpha=<span class="number">0.35</span>)</span><br><span class="line"></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主程序</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    json_path = <span class="string">&#x27;TestData_coco.json&#x27;</span></span><br><span class="line">    image_dir = <span class="string">&#x27;images&#x27;</span></span><br><span class="line">    image_id_to_visualize = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加载COCO JSON文件</span></span><br><span class="line">    coco_data = load_coco_data(json_path)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 下载图像</span></span><br><span class="line">    download_images(coco_data, image_dir)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 转换数据格式</span></span><br><span class="line">    transformed_data = transform_data(coco_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 可视化图像ID为1000的图像及其标签</span></span><br><span class="line">    visualize_image(image_id_to_visualize, transformed_data, image_dir, coco_data)</span><br></pre></td></tr></table></figure>

<p>可行程序2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pycocotools.coco <span class="keyword">import</span> COCO</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取标签数据</span></span><br><span class="line">dataDir = <span class="string">&#x27;.&#x27;</span></span><br><span class="line">dataType = <span class="string">&#x27;val2017&#x27;</span></span><br><span class="line">annFile = <span class="string">&#x27;&#123;&#125;/TestData_coco.json&#x27;</span>.<span class="built_in">format</span>(dataDir)</span><br><span class="line">coco = COCO(annFile)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载图像数据</span></span><br><span class="line">save_dir = <span class="string">&#x27;./images&#x27;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(save_dir):</span><br><span class="line">    os.makedirs(save_dir)</span><br><span class="line"><span class="keyword">for</span> img_id <span class="keyword">in</span> coco.getImgIds():</span><br><span class="line">    img_info = coco.loadImgs(img_id)[<span class="number">0</span>]</span><br><span class="line">    img_url = img_info[<span class="string">&#x27;coco_url&#x27;</span>]</span><br><span class="line">    img_name = <span class="string">&#x27;&#123;:012d&#125;.jpg&#x27;</span>.<span class="built_in">format</span>(img_id)</span><br><span class="line">    img_path = os.path.join(save_dir, img_name)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(img_path):</span><br><span class="line">        response = requests.get(img_url)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(img_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(response.content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储格式变换</span></span><br><span class="line">data = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> img_id <span class="keyword">in</span> coco.getImgIds():</span><br><span class="line">    img_info = coco.loadImgs(img_id)[<span class="number">0</span>]</span><br><span class="line">    ann_ids = coco.getAnnIds(imgIds=img_id)</span><br><span class="line">    anns = coco.loadAnns(ann_ids)</span><br><span class="line">    categories = []</span><br><span class="line">    bboxes = []</span><br><span class="line">    segmentations = []</span><br><span class="line">    <span class="keyword">for</span> ann <span class="keyword">in</span> anns:</span><br><span class="line">        categories.append(ann[<span class="string">&#x27;category_id&#x27;</span>])</span><br><span class="line">        bboxes.append(ann[<span class="string">&#x27;bbox&#x27;</span>])</span><br><span class="line">        segmentations.append(ann[<span class="string">&#x27;segmentation&#x27;</span>])</span><br><span class="line">    data[img_id] = &#123;<span class="string">&#x27;image_ids&#x27;</span>: [img_id], <span class="string">&#x27;category_ids&#x27;</span>: categories, <span class="string">&#x27;bboxes&#x27;</span>: bboxes, <span class="string">&#x27;segmentations&#x27;</span>: segmentations&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化图像ID为1000的图像及标签</span></span><br><span class="line">img_id = <span class="number">1000</span></span><br><span class="line">img_info = coco.loadImgs(img_id)[<span class="number">0</span>]</span><br><span class="line">img_path = os.path.join(save_dir, img_info[<span class="string">&#x27;file_name&#x27;</span>])</span><br><span class="line">img = cv2.imread(img_path)</span><br><span class="line">ann_ids = coco.getAnnIds(imgIds=img_id)</span><br><span class="line">anns = coco.loadAnns(ann_ids)</span><br><span class="line"><span class="keyword">for</span> ann <span class="keyword">in</span> anns:</span><br><span class="line">    bbox = ann[<span class="string">&#x27;bbox&#x27;</span>]</span><br><span class="line">    segmentation = ann[<span class="string">&#x27;segmentation&#x27;</span>]</span><br><span class="line">    category_id = ann[<span class="string">&#x27;category_id&#x27;</span>]</span><br><span class="line">    category_info = coco.loadCats(category_id)[<span class="number">0</span>]</span><br><span class="line">    category_name = category_info[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    color = <span class="built_in">tuple</span>(np.random.randint(<span class="number">0</span>, <span class="number">256</span>, <span class="number">3</span>).tolist())</span><br><span class="line">    cv2.rectangle(img, (<span class="built_in">int</span>(bbox[<span class="number">0</span>]), <span class="built_in">int</span>(bbox[<span class="number">1</span>])), (<span class="built_in">int</span>(bbox[<span class="number">0</span>] + bbox[<span class="number">2</span>]), <span class="built_in">int</span>(bbox[<span class="number">1</span>] + bbox[<span class="number">3</span>])), color, <span class="number">2</span>)</span><br><span class="line">    cv2.putText(img, category_name, (<span class="built_in">int</span>(bbox[<span class="number">0</span>]), <span class="built_in">int</span>(bbox[<span class="number">1</span>]) - <span class="number">5</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="number">0.5</span>, color, <span class="number">2</span>)</span><br><span class="line">    mask = coco.annToMask(ann)</span><br><span class="line">    contour, _ = cv2.findContours(mask, cv2.RETR_TREE, cv2.CHAIN_APPROX_SIMPLE)</span><br><span class="line">    cv2.drawContours(img, contour, -<span class="number">1</span>, color, <span class="number">2</span>)</span><br><span class="line">cv2.imshow(<span class="string">&#x27;image&#x27;</span>, img)</span><br><span class="line">cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">cv2.destroyAllWindows()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</div> 

<script>
    window.onload = detectors();
</script>
    <div class="post-footer">
    <div class="h-line-primary"></div>
    <nav class="post-nav">
        <div class="prev-item">
           
                <div class="icon arrow-left"></div>
                <div class="post-link">
                    <a href="/2023/07/08/mindspoer%E7%9A%84%E5%AE%89%E8%A3%85/">Prev</a>
                </div>
            
        </div>
        <div class="next-item">
            
                <div class="icon arrow-right"></div>
                <div class="post-link">
                  <a href="/2023/05/22/linux%E6%8D%A2%E6%BA%90/">Next</a>  
                </div>  
            
        </div>
    </nav>
</div>

    
      <div class="post-comment">

     

     


    
       <!--PC版-->
        <div id="SOHUCS" ></div>
        <script charset="utf-8" type="text/javascript" src="https://cy-cdn.kuaizhan.com/upload/changyan.js" ></script>
        <script type="text/javascript">
        window.changyan.api.config({
            appid: 'cywJvGKKO',
            conf: 'prod_dfd0ec91693832034dcc62943592b045'
        });
        </script>   
     

</div>
     
  
</article>
        </div>
      </div>
      
      <div class="footer">
    <div class="flex-container">
        <div class="footer-text">
            
                人生得意须尽欢，莫使金樽空对月.
                <br>
            
            
                xuan_tu | 
            
                
        </div>
    </div>
</div>

    </div>

    
    

  </body>
</html>
